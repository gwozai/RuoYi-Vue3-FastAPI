# 本地开发环境启动指南

本文档介绍如何在本地启动 RuoYi-Vue3-FastAPI 项目进行开发。

---

## 环境要求

| 环境 | 版本要求 | 说明 |
|------|----------|------|
| Node.js | ≥ 18 | 前端运行环境 |
| Python | ≥ 3.9 | 后端运行环境 |
| MySQL | ≥ 5.7 | 数据库（或 PostgreSQL） |
| Redis | ≥ 5.0 | 缓存服务 |

---

## 快速启动

### 1. 启动基础服务（MySQL + Redis）

项目使用 Docker Compose 管理基础服务：

```bash
# 进入项目根目录
cd RuoYi-Vue3-FastAPI

# 启动 MySQL 和 Redis
docker-compose up -d
```

**服务端口**：
- MySQL: `30306`（用户名: root，密码: mysqlroot）
- Redis: `30379`

> 如果你本地已有 MySQL 和 Redis，可以跳过此步骤，直接修改配置文件。

### 2. 初始化数据库

首次运行需要导入数据库：

```bash
# 连接 MySQL
mysql -h 127.0.0.1 -P 30306 -u root -pmysqlroot

# 创建数据库
CREATE DATABASE `ruoyi-fastapi` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

# 导入数据
USE `ruoyi-fastapi`;
SOURCE ruoyi-fastapi-backend/sql/ruoyi-fastapi.sql;
```

或使用 Navicat、DBeaver 等工具导入。

### 3. 启动后端

```bash
# 进入后端目录
cd ruoyi-fastapi-backend

# 安装依赖（首次运行）
pip install -r requirements.txt

# 启动后端服务
python app.py --env=dev
```

后端启动成功后：
- API 地址：`http://localhost:9099`
- API 文档：`http://localhost:9099/docs`

### 4. 启动前端

```bash
# 进入前端目录
cd ruoyi-fastapi-frontend

# 安装依赖（首次运行）
npm install --registry=https://registry.npmmirror.com

# 启动前端服务
npm run dev
```

前端启动成功后：
- 访问地址：`http://localhost:80`
- 默认账号：`admin`
- 默认密码：`admin123`

---

## 配置文件说明

### 后端配置

配置文件位置：`ruoyi-fastapi-backend/.env.dev`

```ini
# -------- 应用配置 --------
APP_ENV = 'dev'              # 运行环境
APP_HOST = '0.0.0.0'         # 监听地址
APP_PORT = 9099              # 监听端口
APP_ROOT_PATH = '/dev-api'   # API 代理路径

# -------- 数据库配置 --------
DB_TYPE = 'mysql'            # 数据库类型 (mysql/postgresql)
DB_HOST = '127.0.0.1'        # 数据库地址
DB_PORT = 30306              # 数据库端口
DB_USERNAME = 'root'         # 数据库用户名
DB_PASSWORD = 'mysqlroot'    # 数据库密码
DB_DATABASE = 'ruoyi-fastapi' # 数据库名称

# -------- Redis配置 --------
REDIS_HOST = '127.0.0.1'     # Redis 地址
REDIS_PORT = 30379           # Redis 端口
REDIS_PASSWORD = ''          # Redis 密码
REDIS_DATABASE = 2           # Redis 数据库
```

### 前端配置

配置文件位置：`ruoyi-fastapi-frontend/.env.development`

```ini
# 开发环境配置
VITE_APP_ENV = 'development'

# 后端 API 代理地址
VITE_APP_BASE_API = '/dev-api'
```

---

## 常用命令

### 后端命令

```bash
# 开发环境启动
python app.py --env=dev

# 生产环境启动
python app.py --env=prod

# 查看帮助
python app.py --help
```

### 前端命令

```bash
# 开发环境启动
npm run dev

# 构建测试环境
npm run build:stage

# 构建生产环境
npm run build:prod

# 代码格式化
npm run lint
```

### Docker 命令

```bash
# 启动所有服务
docker-compose up -d

# 停止所有服务
docker-compose down

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f mysql
docker-compose logs -f redis
```

---

## 开发工具推荐

### IDE
- **后端**：PyCharm / VS Code + Python 插件
- **前端**：VS Code + Volar 插件

### 数据库工具
- Navicat
- DBeaver
- DataGrip

### API 测试
- Postman
- Apifox
- 内置 Swagger：`http://localhost:9099/docs`

---

## 常见问题

### Q: 前端启动报错 "node version"

**A**: 确保 Node.js 版本 ≥ 18，使用 `node -v` 检查版本。

### Q: 后端连接数据库失败

**A**: 检查以下几点：
1. MySQL 服务是否启动
2. `.env.dev` 中的数据库配置是否正确
3. 数据库 `ruoyi-fastapi` 是否已创建

### Q: Redis 连接失败

**A**: 检查以下几点：
1. Redis 服务是否启动
2. `.env.dev` 中的 Redis 配置是否正确
3. 如果 Redis 有密码，确保配置了 `REDIS_PASSWORD`

### Q: 前端页面空白

**A**: 检查以下几点：
1. 后端服务是否正常启动
2. 浏览器控制台是否有报错
3. 尝试清除浏览器缓存后刷新

### Q: 登录验证码不显示

**A**: 验证码由后端生成，确保后端服务正常运行。

### Q: 如何修改端口

**后端端口**：修改 `.env.dev` 中的 `APP_PORT`

**前端端口**：修改 `vite.config.js` 中的 `server.port`

---

## 项目结构

```
RuoYi-Vue3-FastAPI/
├── ruoyi-fastapi-backend/     # 后端项目
│   ├── app.py                 # 启动入口
│   ├── server.py              # 路由注册
│   ├── config/                # 配置文件
│   ├── module_admin/          # 系统管理模块
│   ├── module_generator/      # 代码生成模块
│   ├── scripts/               # 开发脚本
│   ├── sql/                   # 数据库脚本
│   ├── .env.dev               # 开发环境配置
│   └── .env.prod              # 生产环境配置
│
├── ruoyi-fastapi-frontend/    # 前端项目
│   ├── src/
│   │   ├── api/               # API 接口
│   │   ├── views/             # 页面组件
│   │   ├── components/        # 公共组件
│   │   └── router/            # 路由配置
│   ├── .env.development       # 开发环境配置
│   └── .env.production        # 生产环境配置
│
├── docs/                      # 项目文档
├── docker-compose.yml         # Docker 编排文件
└── README.md                  # 项目说明
```

---

## 开发流程

### 1. 新增后端接口

1. 在 `module_admin/entity/do/` 创建数据库实体
2. 在 `module_admin/entity/vo/` 创建 Pydantic 模型
3. 在 `module_admin/dao/` 创建数据访问层
4. 在 `module_admin/service/` 创建业务逻辑层
5. 在 `module_admin/controller/` 创建控制器
6. 在 `server.py` 注册路由

### 2. 新增前端页面

1. 在 `src/api/` 创建 API 接口文件
2. 在 `src/views/` 创建 Vue 页面组件
3. 在系统菜单管理中添加菜单

### 3. 使用代码生成器

```python
from scripts.gen_api import generate_crud

generate_crud(
    sql='CREATE TABLE ...',
    module='system',
    business='example'
)
```

详见 [API代码生成使用教程](./API代码生成使用教程.md)

---

## 联系方式

如有问题，可通过以下方式获取帮助：

- 项目 Issues：https://gitee.com/insistence2022/RuoYi-Vue3-FastAPI/issues
- 项目文档：查看 `docs/` 目录下的其他文档
