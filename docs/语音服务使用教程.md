# 语音服务使用教程

本教程介绍如何使用 RuoYi-Vue3-FastAPI 系统中的语音服务模块，包括 TTS API 配置管理和音频生成功能。

## 目录

- [功能概述](#功能概述)
- [TTS API 配置管理](#tts-api-配置管理)
  - [添加配置](#添加配置)
  - [管理配置](#管理配置)
  - [权限说明](#权限说明)
- [音频生成](#音频生成)
  - [基本使用](#基本使用)
  - [参数说明](#参数说明)
  - [选择 TTS 配置](#选择-tts-配置)
- [音频管理](#音频管理)
- [API 接口](#api-接口)

---

## 功能概述

语音服务模块提供文本转语音（TTS）功能，主要包含两个子模块：

| 模块 | 功能 | 路径 |
|------|------|------|
| **TTS API配置** | 管理 TTS API 的连接配置 | `/voice/ttsConfig` |
| **音频生成** | 将文本转换为语音并管理生成的音频 | `/voice/audio` |

---

## TTS API 配置管理

在使用音频生成功能之前，需要先配置 TTS API 信息。

### 添加配置

1. 进入 **语音服务 > TTS API配置**
2. 点击 **新增** 按钮
3. 填写配置信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| 用户 | 配置所属用户（仅管理员可见） | 超级管理员 (admin) |
| 配置名称 | 配置的显示名称 | 我的TTS服务 |
| API地址 | TTS API 的完整 URL | `http://example.com/v1/audio/speech` |
| API密钥 | API 认证密钥 | `sk-xxxxxxxxxxxx` |
| API模型 | 使用的 TTS 模型 | `tts-1` |
| 是否默认 | 是否设为默认配置 | 是/否 |
| 状态 | 配置是否启用 | 正常/停用 |
| 备注 | 配置说明 | 用于日常语音生成 |

4. 点击 **确定** 保存

### 管理配置

- **修改**：点击配置行的"修改"按钮，编辑配置信息
- **删除**：点击"删除"按钮移除配置
- **搜索**：使用搜索栏按配置名称、API地址等条件筛选
- **导出**：点击"导出"按钮导出配置列表

### 权限说明

| 用户类型 | 查看 | 添加 | 修改/删除 |
|---------|------|------|----------|
| **管理员** | 所有用户的配置 | 可为任意用户添加 | 所有配置 |
| **普通用户** | 仅自己的配置 | 仅为自己添加 | 仅自己的配置 |

---

## 音频生成

### 基本使用

1. 进入 **语音服务 > 音频生成**
2. 在 **输入文本** 框中输入要转换的文字（最多5000字）
3. 选择语音参数（可选）
4. 点击 **生成音频** 按钮
5. 等待生成完成，音频会出现在下方列表中

### 参数说明

| 参数 | 说明 | 默认值 | 可选值 |
|------|------|--------|--------|
| **TTS配置** | 选择使用的 API 配置 | 默认配置 | 用户的所有配置 |
| **音频名称** | 生成音频的名称 | 自动生成 | 自定义名称 |
| **语音模型** | 语音的声音类型 | zh-CN-XiaoxiaoNeural | 多种中英文语音 |
| **语速** | 语音播放速度 | 1.0 | 0.25 - 4.0 |
| **音频格式** | 输出文件格式 | MP3 | MP3/WAV/FLAC |

### 语音模型列表

系统内置多种语音模型：

**中文语音：**
- `zh-CN-XiaoxiaoNeural` - 晓晓 (女声-中文)
- `zh-CN-YunxiNeural` - 云希 (男声-中文)
- `zh-CN-YunyangNeural` - 云扬 (男声-中文)
- `zh-CN-XiaoyiNeural` - 晓伊 (女声-中文)

**英文语音：**
- `en-US-JennyNeural` - Jenny (女声-英文)
- `en-US-GuyNeural` - Guy (男声-英文)
- `en-GB-SoniaNeural` - Sonia (女声-英式)

### 选择 TTS 配置

如果您有多个 TTS API 配置，可以在生成音频时选择使用哪个：

1. 在 **TTS配置** 下拉框中选择配置
2. 默认会自动选中标记为"默认"的配置
3. 留空则使用系统默认配置

**配置优先级：**
1. 用户选择的指定配置
2. 用户的默认配置
3. 用户的第一个可用配置
4. 系统默认配置

---

## 音频管理

生成的音频会显示在页面下方的列表中，支持以下操作：

| 操作 | 说明 |
|------|------|
| **播放** | 在线播放音频 |
| **下载** | 下载音频文件到本地 |
| **删除** | 删除音频记录和文件 |
| **搜索** | 按名称、语音模型、状态等筛选 |
| **批量删除** | 勾选多条记录后批量删除 |

### 音频列表字段

| 字段 | 说明 |
|------|------|
| ID | 音频唯一标识 |
| 音频名称 | 音频的显示名称 |
| 输入文本 | 生成音频的原始文本 |
| 语音模型 | 使用的语音类型 |
| 语速 | 播放速度 |
| 格式 | 文件格式 (mp3/wav/flac) |
| 文件大小 | 音频文件大小 |
| 状态 | 成功/失败 |
| 创建时间 | 生成时间 |

---

## API 接口

### TTS 配置接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/system/ttsConfig/list` | 获取配置列表 |
| POST | `/system/ttsConfig` | 添加配置 |
| PUT | `/system/ttsConfig` | 修改配置 |
| DELETE | `/system/ttsConfig/{ids}` | 删除配置 |
| GET | `/system/ttsConfig/{id}` | 获取配置详情 |

### 音频接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/system/audio/list` | 获取音频列表 |
| POST | `/system/audio/generate` | 生成音频 |
| DELETE | `/system/audio/{ids}` | 删除音频 |
| GET | `/system/audio/ttsConfigs/list` | 获取用户TTS配置列表 |

### 生成音频请求示例

```json
POST /system/audio/generate
Content-Type: application/json

{
  "inputText": "你好，这是一段测试文本。",
  "audioName": "测试音频",
  "configId": 1,
  "voice": "zh-CN-XiaoxiaoNeural",
  "model": "tts-1",
  "speed": 1.0,
  "responseFormat": "mp3"
}
```

### 响应示例

```json
{
  "code": 200,
  "msg": "音频生成成功",
  "data": {
    "audioId": 1,
    "audioName": "测试音频",
    "filePath": "/profile/audio/2025/12/07/audio_20251207123456.mp3",
    "fileSize": 12345
  }
}
```

---

## 常见问题

### Q: 生成音频失败怎么办？

1. 检查 TTS API 配置是否正确
2. 确认 API 地址可访问
3. 验证 API 密钥是否有效
4. 查看后端日志获取详细错误信息

### Q: 如何更换默认的 TTS 配置？

1. 进入 TTS API配置页面
2. 修改目标配置，将"是否默认"设为"是"
3. 其他配置会自动变为非默认

### Q: 支持哪些 TTS API？

系统设计兼容 OpenAI TTS API 格式，支持：
- OpenAI TTS API
- Azure Speech Service（需适配）
- 其他兼容 OpenAI 格式的 TTS 服务

### Q: 音频文件存储在哪里？

音频文件存储在服务器的 `vf_admin/upload_path/audio/` 目录下，按日期分文件夹组织。

---

## 技术架构

```
语音服务模块
├── 前端 (Vue3 + Element Plus)
│   ├── /src/views/system/audio/index.vue      # 音频生成页面
│   ├── /src/views/system/ttsConfig/index.vue  # TTS配置页面
│   └── /src/api/system/audio.js               # API 调用
│
└── 后端 (FastAPI + SQLAlchemy)
    ├── /module_admin/controller/audio_controller.py    # 路由控制器
    ├── /module_admin/service/audio_service.py          # 业务逻辑
    ├── /module_admin/dao/audio_dao.py                  # 数据访问
    ├── /module_admin/entity/do/audio_do.py             # 数据模型
    └── /module_admin/entity/vo/audio_vo.py             # 视图模型
```

---

## 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|----------|
| 2025-12-07 | v1.0 | 初始版本，支持基本的音频生成和TTS配置管理 |
| 2025-12-07 | v1.1 | 新增TTS配置选择功能，支持多配置切换 |
| 2025-12-07 | v1.2 | 优化权限控制，管理员可管理所有用户配置 |
